import numpy as np
import matplotlib.pyplot as plt
import pyfits as pf
import matplotlib.cm as cm

folder = [19,20,22,23,28]
Cen = []

for z in folder:
    x = np.loadtxt("{0}centroids.txt".format(z), usecols =(0,))
    y = np.loadtxt("{0}centroids.txt".format(z), usecols = (1,))
    intensity = np.loadtxt("{0}intensity.txt".format(z))

    background = 5000
    # Note for intensity the x and y values are flipped
    centrox = np.array([])
    centroy = np.array([])
    q = 0
    while q < len(x):
        x_max = y[q]
        #print x_max
        y_max = x[q]
        #print y_max
        #print intensity[x_max][y_max]
        x_sum = 0
        y_sum = 0
        deno = 0
        box = np.arange(-25, 25, 1)
        box2 = np.arange(-25,25, 1)
        try:
            for i in box:
                for j in box2:
                    #print x_max+i, y_max+j
                    if (intensity[x_max+i][y_max+j])>=background:
                        #print (intensity[x_max+i][y_max+j])
                        x_sum += (x_max+i)*(intensity[x_max+i][y_max+j])
                        deno += (intensity[x_max+i][y_max+j])
                        y_sum += (y_max+j)*(intensity[x_max+i][y_max+j])
            xavg = x_sum/deno
            yavg = y_sum/deno
        
            centrox = np.append(centrox, yavg)
            centroy = np.append(centroy, xavg)
            #print centrox, centroy
        except IndexError:
            print " ",
        q+=1

    output = np.column_stack((centrox, centroy))
    #np.savetxt ("{0}centroid_points.txt".format(z), output, fmt='%.1i')

################### ccd to radians ###############################
ccdx = np.zeros([3,len(X)])
for h in range(len(X)):
    ccdx[0][h] = centrox[h]
    ccdx[1][h] = centroy[h]
    ccdx[2][h] = 1

ccdx = np.matrix(ccdx)
Tinverse = T.getI()
ccdX = Tinverse*ccdx
XX = np.array(ccdX[0])[0]
YY = np.array(ccdX[1])[0]

RA = np.arctan(-XX/(np.cos(do)-(YY*np.sin(do)))) + ao

part1 =(np.sin(do)-(YY*np.cos(do)))
part2 =((1+XX**2+YY**2)**(1/2))
DEC = np.arcsin(part1/part2)



    ################################# plotting ###################################
    plt.figure()
    plt.imshow(intensity, origin = 'lower', vmin = 0, vmax= 20000, cmap = cm.gray_r, interpolation ='nearest')
    #plt.plot(centrox,centroy, 'ko', mfc = 'none')
    plt.xlim(0,2049)
    plt.ylim(0,2049)
    plt.colorbar()
    # this is how to plot circles on the plot
    i = 0
    while i < (len(centrox)):
        circ  = plt.Circle((centrox[i],centroy[i]),radius = 20, color='m',fill=False)
        plt.gcf()
        plt.gca().add_artist(circ)
        i+=1

plt.show()
